.. _install-kafka-cluster:

======================================
Install with an Existing Kafka Cluster
======================================

.. default-domain:: mongodb

.. facet::
   :name: genre
   :values: tutorial

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

You can install Relational Migrator on an existing Kafka cluster including 
Kafka Connect. This installation method is ideal if you are already running 
Kafka or you have your own approach to installing and configuring Kafka.

Before you Begin 
----------------

You must have Kafka and a Kafka Connect cluster accessible to the computer 
running Relational Migrator.

Steps
-----

.. procedure::
   :style: normal

   .. step:: Install Debezium Source Connect Plugin

      1. Download the source connector archive for your source database.

         - `MySQL Connector plugin archive 
           <https://repo1.maven.org/maven2/io/debezium/debezium-connector-mysql/2.4.1.Final/debezium-connector-mysql-2.4.1.Final-plugin.tar.gz>`__
         - `Postgres Connector plugin archive 
           <https://repo1.maven.org/maven2/io/debezium/debezium-connector-postgres/2.4.1.Final/debezium-connector-postgres-2.4.1.Final-plugin.tar.gz>`__
         - `SQL Server Connector plugin archive 
           <https://repo1.maven.org/maven2/io/debezium/debezium-connector-sqlserver/2.4.1.Final/debezium-connector-sqlserver-2.4.1.Final-plugin.tar.gz>`__ 
         - `Oracle Connector plugin archive 
           <https://repo1.maven.org/maven2/io/debezium/debezium-connector-oracle/2.4.1.Final/debezium-connector-oracle-2.4.1.Final-plugin.tar.gz>`__  
         - `Db2 Connector plugin archive 
           <https://repo1.maven.org/maven2/io/debezium/debezium-connector-db2/2.4.1.Final/debezium-connector-db2-2.4.1.Final-plugin.tar.gz>`__

      #. Unzip the archive.
      
         Locate the ``.jar`` file.

      #. Copy the ``debezium-connector.jar`` file to the ``debezium-connector`` directory.

         From the downloaded archive, copy the ``debezium-connector.jar`` file to the
         ``debezium-connector-xxx`` directory at Kafka Connectâ€™s

      #. Restart you Kafka Connect cluster.
       
         To know if your plugin is successfully registered, you must see the following 
         log statement in the ``kafka-connect`` start up logs:

         .. code-block::
            :copyable: false

            INFO || Added plugin 'io.debezium.connector.sqlserver.SqlServerConnector'

   .. step:: Install Relational Migrator Sink Connect Plugin

      1. Download the latest version of the kafka-connect ``.jar`` file.
      #. Copy the ``kafka-connect-migrator.jar`` file to the ``kafka-connect-migrator`` 
         directory.
      #. Restart your Kafka Connect cluster. 

         To know if your plugin is successfully registered, you must see the following 
         log statement in the ``kafka-connect`` start up logs:

         .. code-block::
            :copyable: false

            INFO || Added plugin 'com.mongodb.migrator.kafka.connect.MigratorSinkConnector'

   .. step:: Install Relational Migrator

      From the `download center <https://www.mongodb.com/try/download/relational-migrator>`__, 
      select the appropriate Relational Migrator installer.

   .. step:: Run Relational Migrator in ``kafka-integrated`` model
    
      To run in ``kafka-integrated`` mode, update the following configurations in your 
      ``user.properties``.

      Your ``user.properties`` file is located in an OS specific location. For more 
      information, see :ref:`Relational Migrator File Locations <file-location>`.

      .. list-table:: 
         :header-rows: 1
         :width: 35 15 50

         * - Property Name
           - Default 
           - Description 

         * - ``spring.profiles.active``
           - local
           - Relational Migrator can be run in the following profile: 
             - ``kafka``: Remote server using embedded server deployment.
             - ``confluent``: Remote server using Confluent Cloud for managed Kafka

             Set the profile value to ``kafka``. 

         * - ``server.port``
           - 8278
           - The port at which the Relation Migrator UI is available.

         * - ``migrator.kafka.bootstrap.servers``
           - No default
           - This is a list of ``host:port`` pairs of your pre-existing kafka cluster. 
             For example: ``kafka-1:9092``, ``kafka-2:9093``.
             
             For more information, see `Worker Configuration Properties 
             <https://docs.confluent.io/platform/current/connect/userguide.html#worker-configuration-properties-file>`__. 

         * - ``migrator.kafka.connect.url``
           - No default 
           - The Kafka Connect host url using the ``{host}:{port}`` format. 
             For example: ``localhost:8083``. 

         * - ``migrator.kafka.connect.metrics.jmx.service.url``
           - No default
           - The Kafka Connect ``jmx`` url. 
             For example:
             ``service:jmx:rmi:///jndi/rmi://localhost:9876/jmxrmi``. 

Learn More
----------

- :ref:`kafka-intro`
- :ref:`install-docker`
- :ref:`install-confluent-kafka`